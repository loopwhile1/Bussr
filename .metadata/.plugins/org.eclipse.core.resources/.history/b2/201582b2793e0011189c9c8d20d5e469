# django
from django.core.cache import cache
from django.contrib.auth.forms import UserCreationForm
from django.views.generic.simple import direct_to_template
from django.http import HttpResponseRedirect
from django.views.generic.simple import direct_to_template
from django.http import HttpResponse

# non django
import logging
import json

# other
from BaseRequestHandler import BaseRequestHandler
from bussr.gft.gftapi import GFDataSource

logger = logging.getLogger(__name__)

def service(request,latParam,lngParam):
    lat = float(latParam)
    lng = float(lngParam)
    getStops = GetStops()
    return getStops.service(request, lat, lng)

class GetStops(BaseRequestHandler):
    def service(self, request, lat, lng):
        dataSource = GFDataSource()
        parsedRows = dataSource.parsedResultsNear(lat, lng)
        jsonOut = json.dumps({'stops':parsedRows})
        return HttpResponse(jsonOut)
